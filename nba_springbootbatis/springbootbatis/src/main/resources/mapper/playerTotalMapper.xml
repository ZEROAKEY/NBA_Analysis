<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.SpringBootBatis.mapper.PlayerTotalMapper">

    <!-- 联合查询的SQL，使用 resultMap -->
    <select id="getPlayerTotalsByEachParameterAndSortByIndex" parameterType="map" resultType="com.example.SpringBootBatis.bean.dataBase.PlayerTotalBean">
        SELECT * FROM players_info p
        JOIN nba_players_stats s ON p.player_name = s.player_name
        <trim prefix="WHERE" suffixOverrides="AND">
            <!-- 赛季年份条件 -->
            <if test="season_year != null">
                s.season_year = #{season_year} AND
            </if>

            <!-- 职位条件，模糊匹配职位且支持“锋卫摇摆人” -->
            <if test="position != null and position != ''">
                (s.position LIKE '%' || #{position} || '%'
                <if test="position != '后卫'">
                    OR s.position = '锋卫摇摆人'
                </if>) AND
            </if>

            <!-- 模糊匹配球员名字 -->
            <if test="player_name != null and player_name != ''">
                (p.player_name LIKE '%' || #{player_name} || '%') AND
            </if>

            <!-- 通过 team_id 查询 -->
            <if test="team_id != null and team_id != ''">
                s.team_id = #{team_id} AND
            </if>

            <!-- 中文队名映射到英文队名并支持模糊匹配 -->
            <if test="team_name != null and team_name != ''">
                s.team_name LIKE
                <trim prefix="CASE" suffix="END">
                    <trim prefix="WHEN #{team_name} = '亚特兰大老鹰' THEN "> '%Atlanta Hawks%' </trim>
                    <trim prefix="WHEN #{team_name} = '波士顿凯尔特人' THEN "> '%Boston Celtics%' </trim>
                    <trim prefix="WHEN #{team_name} = '布鲁克林篮网' THEN "> '%Brooklyn Nets%' </trim>
                    <trim prefix="WHEN #{team_name} = '夏洛特黄蜂' THEN "> '%Charlotte Hornets%' </trim>
                    <trim prefix="WHEN #{team_name} = '芝加哥公牛' THEN "> '%Chicago Bulls%' </trim>
                    <trim prefix="WHEN #{team_name} = '克利夫兰骑士' THEN "> '%Cleveland Cavaliers%' </trim>
                    <trim prefix="WHEN #{team_name} = '达拉斯独行侠' THEN "> '%Dallas Mavericks%' </trim>
                    <trim prefix="WHEN #{team_name} = '丹佛掘金' THEN "> '%Denver Nuggets%' </trim>
                    <trim prefix="WHEN #{team_name} = '底特律活塞' THEN "> '%Detroit Pistons%' </trim>
                    <trim prefix="WHEN #{team_name} = '金州勇士' THEN "> '%Golden State Warriors%' </trim>
                    <trim prefix="WHEN #{team_name} = '休斯顿火箭' THEN "> '%Houston Rockets%' </trim>
                    <trim prefix="WHEN #{team_name} = '印第安纳步行者' THEN "> '%Indiana Pacers%' </trim>
                    <trim prefix="WHEN #{team_name} = '洛杉矶快船' THEN "> '%Los Angeles Clippers%' </trim>
                    <trim prefix="WHEN #{team_name} = '洛杉矶湖人' THEN "> '%Los Angeles Lakers%' </trim>
                    <trim prefix="WHEN #{team_name} = '孟菲斯灰熊' THEN "> '%Memphis Grizzlies%' </trim>
                    <trim prefix="WHEN #{team_name} = '迈阿密热火' THEN "> '%Miami Heat%' </trim>
                    <trim prefix="WHEN #{team_name} = '密尔沃基雄鹿' THEN "> '%Milwaukee Bucks%' </trim>
                    <trim prefix="WHEN #{team_name} = '明尼苏达森林狼' THEN "> '%Minnesota Timberwolves%' </trim>
                    <trim prefix="WHEN #{team_name} = '新奥尔良鹈鹕' THEN "> '%New Orleans Pelicans%' </trim>
                    <trim prefix="WHEN #{team_name} = '纽约尼克斯' THEN "> '%New York Knicks%' </trim>
                    <trim prefix="WHEN #{team_name} = '俄克拉荷马城雷霆' THEN "> '%Oklahoma City Thunder%' </trim>
                    <trim prefix="WHEN #{team_name} = '奥兰多魔术' THEN "> '%Orlando Magic%' </trim>
                    <trim prefix="WHEN #{team_name} = '费城76人' THEN "> '%Philadelphia 76ers%' </trim>
                    <trim prefix="WHEN #{team_name} = '菲尼克斯太阳' THEN "> '%Phoenix Suns%' </trim>
                    <trim prefix="WHEN #{team_name} = '波特兰开拓者' THEN "> '%Portland Trail Blazers%' </trim>
                    <trim prefix="WHEN #{team_name} = '萨克拉门托国王' THEN "> '%Sacramento Kings%' </trim>
                    <trim prefix="WHEN #{team_name} = '圣安东尼奥马刺' THEN "> '%San Antonio Spurs%' </trim>
                    <trim prefix="WHEN #{team_name} = '多伦多猛龙' THEN "> '%Toronto Raptors%' </trim>
                    <trim prefix="WHEN #{team_name} = '犹他爵士' THEN "> '%Utah Jazz%' </trim>
                    <trim prefix="WHEN #{team_name} = '华盛顿奇才' THEN "> '%Washington Wizards%' </trim>
                </trim>
            </if>
        </trim>

        <!-- 动态排序 -->
        <if test="index != null and index != ''">
            ORDER BY ${index} DESC
        </if>
    </select>

</mapper>
